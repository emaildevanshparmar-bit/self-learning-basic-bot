<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NeuroBot</title>
<style>
  body {
    background: #0b0c10;
    color: #c5c6c7;
    font-family: 'Segoe UI', sans-serif;
    margin: 0;
    display: flex;
    height: 100vh;
  }
  #sidebar, #about {
    width: 20%;
    padding: 15px;
    background: #1f2833;
    display: flex;
    flex-direction: column;
    justify-content: center;
    text-align: center;
  }
  #chat {
    flex: 1;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    padding: 20px;
  }
  #messages {
    flex: 1;
    overflow-y: auto;
    margin-bottom: 10px;
  }
  .bubble {
    padding: 10px 15px;
    border-radius: 12px;
    margin: 8px 0;
    max-width: 75%;
    animation: fadeIn 0.3s ease;
  }
  .user { background: #45a29e; align-self: flex-end; }
  .bot { background: #1f2833; align-self: flex-start; }
  @keyframes fadeIn { from { opacity: 0; transform: translateY(5px);} to { opacity: 1; transform: translateY(0);} }
  input { width: 80%; padding: 10px; border-radius: 5px; border: none; }
  button { background: #66fcf1; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer; }
  button:hover { background: #45a29e; }
  #memoryManager {
    display: none;
    background: #0b0c10;
    position: fixed;
    top: 10%;
    left: 10%;
    width: 80%;
    height: 80%;
    overflow-y: auto;
    border: 2px solid #45a29e;
    padding: 20px;
    z-index: 999;
  }
</style>
</head>
<body>

<div id="sidebar">
  <h3>‚ö†Ô∏è Disclaimer</h3>
  <p>This bot learns from public input. All responses are visible to others. Do <b>not</b> enter personal information.</p>
</div>

<div id="chat">
  <div id="messages"></div>
  <div>
    <input id="userInput" placeholder="Type a message..." />
    <button id="sendBtn">Send</button>
    <button id="memoriesBtn">Memories</button>
  </div>
</div>

<div id="about">
  <h3>üë®‚Äçüíª About Developer</h3>
  <p>Made with HTML, CSS, JavaScript, and Firebase.<br> Created to explore crowd-taught AI learning.</p>
</div>

<div id="memoryManager"></div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import { getFirestore, doc, getDoc, setDoc, updateDoc, arrayUnion } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBKqdSgdGexXwpoWOW8m87BEziPXl13nwc",
    authDomain: "neurobot-selflearning.firebaseapp.com",
    projectId: "neurobot-selflearning",
    storageBucket: "neurobot-selflearning.firebasestorage.app",
    messagingSenderId: "437939077021",
    appId: "1:437939077021:web:2a8197e7b9060d884ab974",
    measurementId: "G-G1CVJ0W44H"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const messages = document.getElementById("messages");
  const input = document.getElementById("userInput");
  const sendBtn = document.getElementById("sendBtn");
  const memoryBtn = document.getElementById("memoriesBtn");
  const memoryManager = document.getElementById("memoryManager");

  function addMessage(text, sender) {
    const div = document.createElement("div");
    div.classList.add("bubble", sender);
    div.textContent = text;
    messages.appendChild(div);
    messages.scrollTop = messages.scrollHeight;
  }

  function typeMessage(text) {
    let i = 0;
    const div = document.createElement("div");
    div.classList.add("bubble", "bot");
    messages.appendChild(div);
    const interval = setInterval(() => {
      div.textContent += text[i];
      i++;
      if (i >= text.length) clearInterval(interval);
    }, 40);
  }

  async function getResponse(question) {
    const q = question.toLowerCase();
    const docRef = doc(db, "responses", q);
    const docSnap = await getDoc(docRef);

    if (docSnap.exists()) {
      const answers = docSnap.data().answers;
      return answers[Math.floor(Math.random() * answers.length)];
    } else {
      const answer = prompt("I don't know this yet! Teach me:");
      if (answer) {
        await setDoc(docRef, { answers: [answer] });
        return "Got it! I learned something new.";
      } else {
        return "Okay, maybe later!";
      }
    }
  }

  async function openMemoryManager() {
    const code = prompt("Enter access code:");
    if (code !== "memories") return alert("Incorrect code.");
    memoryManager.style.display = "block";
    memoryManager.innerHTML = "<h2>NeuroBot Memories</h2>";

    const col = await (await fetch(`https://firestore.googleapis.com/v1/projects/neurobot-selflearning/databases/(default)/documents/responses`)).json();
    if (!col.documents) return memoryManager.innerHTML += "<p>No memories yet.</p>";

    col.documents.forEach(doc => {
      const q = doc.name.split("/").pop();
      const answers = doc.fields.answers.arrayValue.values.map(v => v.stringValue);
      const section = document.createElement("div");
      section.innerHTML = `<h3>${q}</h3>`;
      answers.forEach((ans, i) => {
        const p = document.createElement("p");
        p.textContent = ans;
        const del = document.createElement("button");
        del.textContent = "Delete";
        del.onclick = async () => {
          answers.splice(i, 1);
          await setDoc(docRef, { answers });
          p.remove();
        };
        section.appendChild(p);
        section.appendChild(del);
      });
      memoryManager.appendChild(section);
    });

    const closeBtn = document.createElement("button");
    closeBtn.textContent = "Close";
    closeBtn.onclick = () => memoryManager.style.display = "none";
    memoryManager.appendChild(closeBtn);
  }

  sendBtn.onclick = async () => {
    const text = input.value.trim();
    if (!text) return;
    addMessage(text, "user");
    input.value = "";
    const reply = await getResponse(text);
    setTimeout(() => typeMessage(reply), 400);
  };

  memoryBtn.onclick = openMemoryManager;

  addMessage("üëã Hi! I'm NeuroBot ‚Äî a learning bot powered by public input. Ask me something!", "bot");
</script>
</body>
</html>
